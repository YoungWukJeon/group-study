## 매핑 API 이해하기

#### 매핑
    - 데이터 타입을 지정하는 과정
    - 한 번 지정된 매핑은 변경할 수 없다.
    - 타입을 변경하려면 인덱스를 삭제 후 재생성하거나 매핑을 다시 정의해야한다.
    - 실무에서는 동적 매핑을 거의 사용하지 않는다.

#### 매핑 확인
    - 형식 : GET /index명/_mapping

#### 매핑 파라미터
    - analyzer
        - 해당 필드의 데이터를 형태소 분석하겠다는 의미
        - 별도로 지정하지 않으면 Standard Analyzer로 형태소 분석 수행
    
    - normalizer
        - term query에 분석기를 사용하기 위해 사용
        - ex) cafe, Cafe, Cafe` 등을 모두 동일하게 인식할 수 있음
    
    - boost
        - 필드에 가중치(weight)를 부여
        - 검색 결과의 노출 순서에 영향을 줌
        - 색인 시점에 설정하면 변경할 때 재색인해야하므로, 검색 시점에만 사용하는 것을 권장
        - 최신 엘라스틱서치는 색인 시 boost 설정을 할 수 없도록 변경(루씬에서 제거됨)
    
    - coerce
        - 색인시 자동 형변환 가능 여부 설정
        - ex) "10"을 10으로 인식할 수 있음
    
    - copy_to
        - 매핑 파라미터를 추가한 필드의 값을 지정한 필드로 복사
        - 여러 개의 필드 데이터를 하나의 필드에 모아서 전체 검색 용도로 사용하기도 함
        - 과거의 _all 칼럼과 동일한 기능 제공
        - ex) movieNm과 movieNmEn의 결과를 결합한 "살아남은 아이 Last Child"라는 데이터를 저장하는 필드를 생성 가능

    - fielddata
        - 힙 공간에 생성하는 메모리 캐시
        - 반복적인 메모리 부족 현상과 잦은 GC로 현재는 거의 사용하지 않음
        - 최신버전에서는 doc_values를 사용(text 타입을 제외한 나머지 타입은 대부분 이걸 이용)
        - 기본적으로 비활성화
    
    - doc_values
        - 엘라스틱서치에서 사용하는 기본 캐시
        - 운영체제의 파일 시스템 캐시를 통해 디스크에 있는 데이터에 빠르게 접근할 수 있다.
        - 비활성화 시킬수 있고, 비활성화된 필드는 인덱스를 재색인하지 않는 한 변경이 불가

    - dynamic
        - 매핑에 필드를 추가할 때 동적으로 생성할지, 생성하지 않을지를 결정
        - 옵션
            - true : 새로 추가되는 필드를 매핑에 추가
            - false : 새로 추가되는 필드를 무시한다. 해당 필드는 색인되지 않아 검색할 수 없지만 _source에는 표시됨
            - strict : 새로운 필드가 감지되면 예외가 발생하고 문서 자체가 색인되지는 않음. 새로 유입되는 필드는 사용자가 매핑에 명시적으로 추가해야 함.

    - enabled
        - 검색 결과에는 포함하지만 색인은 하고 싶지 않을 경우에 사용
        - enabled를 false로 설정하면 _source에는 검색이 되지만 색인은 하지 않는다.

    - format
        - 엘라스틱서치는 날짜/시간을 문자열로 표시
        - 이를 지정하는 형식

    - ignore_above
        - 필드에 저장되는 문자열이 지정한 크기를 넘어서면 빈 값으로 색인
        - 지정한 길이를 넘어서면 완전 빈 값을 넣는다는 의미
    
    - ignore_malformed
        - 잘못된 데이터 타입을 색인하려고 하면 예외가 발생하고 해당 문서 전체가 색인되지 않는다.
        - 해당 필드만 무시하고 문서는 색인할 수 있게 해줌

    - index
        - 필드 값을 색인할지를 결정
        - 기본 값은 true

    - fields
        - 다중 필드(multi_field)를 설정할 수 있는 옵션
        - 같은 string 값을 각각 다른 분석기로 처리할 수 있도록 설정 가능

    - norms
        - 문서의 _score 값 계산에 필요한 정규화 인수를 사용할지 여부를 설정
        - 기본 값은 true
        - 검색 결과에 영향을 미칠 필요가 없는 필드를 _score에서 제거하기 위해 사용할 수 있다.(false로 설정해서)
        - _score 계산이 필요없거나 단순 필터링 용도로 사용하는 필드는 비활성화해서 디스크 공간을 절약할 수 있다.
        
    - null_value
        - null 값이 들어오면 필드를 생성하고 그에 해당하는 값으로 저장
        - ex) "null_value": "0"
    
    - position_increment_gap
        - 배열(Array) 형태의 데이터를 색인할 때 검색의 정확도를 높이기 위해 제공하는 옵션
        - 필드 데이터 중 단어와 단어 사이의 간격(slop)을 허용할지를 설정
        - ex) ["John Abraham", "Lincon Smith"]일 때, "Abraham Lincon"으로 검색 가능

    - properties
        - 오브젝트(Object) 타입이나 중첩(Nested) 타입의 스키마를 정의할 때 사용되는 옵션
        - 필드에 사용할 경우 해당 필드의 type은 없음
    
    - search_analyzer
        - 일반적으로는 색인과 검색 시 같은 분석기를 사용한다.
        - 이 옵션을 사용해 별도의 분석기를 사용할 수 있다.
    
    - similarity
        - 유사도 측정 알고리즘을 지정
        - 기본은 BM25

    - store
        - 필드의 값을 저정해 검색 결과에 값을 포함하기 위한 매핑 파라미터
        - 기본적으로 엘라스틱서치에서는 _source에 색인된 문서가 저장된다.
        - 이 옵션을 사용해 해당 필드를 자체적으로 저장할 수 있다.
        - 디스크를 더 많이 사용한다.
        - horizontal sharding 느낌(?)

    - term_vector
        - 루씬에서 분석된 용어의 정보를 포함할지 여부를 결정
        - 인자
            - no : 텀벡터를 저장하지 않음
            - yes : 필드와 용어만 저장
            - with_positions : 용어, 용어의 시작과 끝 위치를 저장
            - with_offsets : 용어, 문자 오프셋을 저장
            - with_positions_offsets : 용어, 용어의 시작과 끝 위치, 문자 오프셋을 모두 저장